<html>
<head>
  <script>
    const deg60 = Math.PI*1/3;
  	const r = 100;
  	const h = r * Math.sqrt(3)/2;
  	
  	const boardX = 400;
  	const boardY = 500;
  	
  	let canvas = null
  	let ctx = null;
  	let savedImageStack = [];
  
  	function saveImage() {
  	  if (canvas) {
  	    savedImageStack.push(ctx.getImageData(0,0,canvas.width,canvas.height));
  	  }
  	}
  
    function resetImage() {
      if (savedImageStack.length) {
        ctx.putImageData(savedImageStack.pop(), 0, 0);
      }
    }
    
    function draw() {
      canvas = document.getElementById('puzzle');
      if (canvas.getContext) {
        ctx = canvas.getContext('2d');
      }
      
      var piece = [0,1,0,0,1];
      
	  saveImage();
      
      drawBoard(boardX,boardY);

      // Draw each of the 12 pieces.
      // x and y are relative to board, in terms of constants r and h.
      drawPiece([0,0,0,1,1], -1, 0.5,  1*Math.PI/6);
      drawPiece([1,1,1,1,0], -2, 1,   -5*Math.PI/6);
      drawPiece([1,0,1,1,0], -2, 2,   -5*Math.PI/6);
      drawPiece([1,0,0,1,0], -2, 2,    1*Math.PI/6);
      drawPiece([1,1,1,1,1], -1, 3.5,  5*Math.PI/6);
      drawPiece([1,1,0,1,0],  0, 2,   -3*Math.PI/6);
      drawPiece([0,0,1,1,1],  0, 1,    3*Math.PI/6);
      drawPiece([1,1,1,0,0],  2, 1,   -5*Math.PI/6);
      drawPiece([0,1,0,1,1],  1, 1.5,  1*Math.PI/6);
      drawPiece([1,1,0,1,1],  3, 1.5, -3*Math.PI/6);
      drawPiece([1,0,1,0,0],  0, 3,    3*Math.PI/6);
      drawPiece([1,0,1,1,1],  2, 3,   -5*Math.PI/6);
      
      saveImage();
    }
    
    // cc = counterclockwise (boolean)
    function drawArc(x1,y1,x2,y2,cc) {
      var diffX = x2 - x1;
      var diffY = y2 - y1;
      var avgX = (x1 + x2) / 2;
      var avgY = (y1 + y2) / 2;
      var ratio = Math.sqrt(3)/2 * (cc ? 1 : -1);
      
      var centerX = avgX + diffY * ratio;
      var centerY = avgY - diffX * ratio;
      
      var startAngle = Math.atan2(y1 - centerY, x1 - centerX);
      var endAngle = Math.atan2(y2 - centerY, x2 - centerX);  // = start - deg60
      ctx.arc(centerX, centerY, r, startAngle, endAngle, cc);
    }
    
    // xyList is an array of x,y coords
    // ccList is an optional array of equal length of counterclockwise booleans
    // ccList[i] refers to arc between xyList[i] and xyList[i+1]
    function drawArcCycle(xyList, ccList) {
      // default to all clockwise if no ccList given
      ccList = ccList || Array(xyList.length).fill(false);
      
      ctx.beginPath();
      
      let x0,y0,x1,x2,y1,y2;
      for (let i=0; i<xyList.length-1; i++) {
        [x1,y1] = xyList[i];
        [x2,y2] = xyList[i+1];
        drawArc(x1,y1,x2,y2,ccList[i]);
      }
      [x0,y0] = xyList[0];
      drawArc(x2,y2,x0,y0,ccList[ccList.length-1]);
      
      ctx.stroke();
    }
    
    // x in terms of h
    // y in terms of -r
    function drawPiece(piece,x,y,theta) {
      x = x * h + boardX;
      y = -y * r + boardY;
    
      ctx.save();
	  ctx.translate(x, y);
	  ctx.rotate(theta);

	  drawArcCycle([[-r,0],
	  				[-r/2,-h],
	  				[r/2,-h],
	  				[r,0],
	  				[0,0]],
	  			   piece.map((a) => !a)
	  			  );
	  
	  ctx.restore();
    }
    
    function drawBoard(x,y) {
      ctx.save();
      ctx.translate(x,y);
      
      const pts = [[ 0, 0],
                   [-1, 0.5],
                   [-2, 0],
                   [-3, 0.5],
                   [-3, 1.5],
                   [-3, 2.5],
                   [-2, 3],
                   [-1, 3.5],
                   [ 0, 4],
                   [ 1, 3.5],
                   [ 2, 3],
                   [ 3, 2.5],
                   [ 3, 1.5],
                   [ 3, 0.5],
                   [ 2, 0],
                   [ 1, 0.5]
                  ];
      
	  drawArcCycle(pts.map(([x,y]) => [x*h, -y*r]));
	  
      ctx.restore();
    }
    
  </script>
  <style type="text/css">
    canvas { border: 1px solid black; }
  </style>
</head>
<body onload="draw();">
  <div>
    Puzzle:
  </div>
  <canvas id="puzzle" height="700" width="900">
    
  </canvas>
</body>
</html>
